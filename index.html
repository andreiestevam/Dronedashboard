<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Programa de Policiamento com Drones</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#111827; color:white; }
    .grid-container { display:grid; gap:1rem; grid-template-columns:repeat(2,1fr); }
    .video-card{ background:#1f2937; border-radius:12px; overflow:hidden; border:1px solid #374151; }
    .video-box{ aspect-ratio:16/9; position:relative; }
    .player-fill{ position:absolute; inset:0; }
    .badge-live{ background:#dc2626; }
  </style>

  <!-- YouTube API -->
  <script src="https://www.youtube.com/iframe_api"></script>
  <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
  // ==== Firebase config (o SEU) ====
  const FIREBASE = {
    apiKey: "AIzaSyDadspZB30sQOgZr7PTcSbub1ZJB80Kui4",
    authDomain: "dashboarddronepmesp.firebaseapp.com",
    databaseURL: "https://dashboarddronepmesp-default-rtdb.firebaseio.com",
    projectId: "dashboarddronepmesp",
    storageBucket: "dashboarddronepmesp.firebasestorage.app",
    messagingSenderId: "769998411213",
    appId: "1:769998411213:web:f0ecce2126f0af9b4a2084",
    measurementId: "G-4TVLS703CF"
  };

  // Inicializa Firebase
  firebase.initializeApp(FIREBASE);
  const db = firebase.database();
  const dbRef = db.ref("dashboards/main"); // caminho único do dashboard

  let VIDEO_IDS=[], LABELS=[], LOCS=[];
  let YT_READY=false;

  function escapeHtml(str){return String(str).replace(/[&<>"']/g,s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s]));}

  window.onYouTubeIframeAPIReady=function(){ YT_READY=true; renderGrid(); };

  function renderGrid(){
    const grid=document.getElementById("gridContainer");
    grid.innerHTML="";
    VIDEO_IDS.forEach((id,i)=>{
      const card=document.createElement("div");
      card.className="video-card";
      card.innerHTML=`
        <div class="video-box">
          <div id="yt_${i}" class="player-fill"></div>
          <div class="absolute top-2 left-2 px-2 py-1 rounded text-xs badge-live">AO VIVO</div>
        </div>
        <div class="p-2 bg-gray-800">
          <h3 class="font-semibold text-sm">${escapeHtml(LABELS[i]||"Equipe "+(i+1))}</h3>
          <p class="text-xs text-gray-400">${escapeHtml(LOCS[i]||"")}</p>
        </div>
      `;
      grid.appendChild(card);
      if(YT_READY){
        new YT.Player(`yt_${i}`, {
          videoId:id,
          playerVars:{autoplay:1, mute:1, controls:0, playsinline:1}
        });
      }
    });
  }

  // Editor salva
  function saveConfig(){
    dbRef.set({ids:VIDEO_IDS, labels:LABELS, locs:LOCS, ts:Date.now()});
  }

  // Viewer ou Editor carrega
  dbRef.on("value", snap=>{
    const j=snap.val(); if(!j) return;
    VIDEO_IDS=j.ids||[]; LABELS=j.labels||[]; LOCS=j.locs||[];
    renderGrid();
  });

  function addTeam(){
    const id=document.getElementById("youtubeUrl").value.split("v=")[1];
    const name=document.getElementById("teamName").value;
    const loc=document.getElementById("teamLocation").value;
    VIDEO_IDS.push(id); LABELS.push(name); LOCS.push(loc);
    saveConfig();
    document.getElementById("teamForm").reset();
  }
  </script>
</head>
<body class="min-h-screen">

  <header class="p-4 bg-gray-900 flex justify-between items-center">
    <h1 class="text-lg font-bold">Dashboard Programa de Policiamento com Drones</h1>
    <button onclick="document.getElementById('configModal').classList.remove('hidden')" class="bg-blue-600 px-3 py-1 rounded">Inserir Equipe</button>
  </header>

  <main class="p-4 max-w-7xl mx-auto">
    <div id="gridContainer" class="grid-container"></div>
  </main>

  <!-- Modal Inserir -->
  <div id="configModal" class="fixed inset-0 bg-black/60 hidden flex items-center justify-center">
    <div class="bg-gray-800 p-6 rounded w-full max-w-md">
      <h3 class="text-lg mb-4">Inserir Equipe</h3>
      <form id="teamForm" onsubmit="event.preventDefault(); addTeam(); document.getElementById('configModal').classList.add('hidden');">
        <input id="teamName" class="w-full mb-2 p-2 bg-gray-700 rounded" placeholder="Nome da Equipe" required>
        <input id="teamLocation" class="w-full mb-2 p-2 bg-gray-700 rounded" placeholder="Endereço da Operação">
        <input id="youtubeUrl" class="w-full mb-2 p-2 bg-gray-700 rounded" placeholder="URL do YouTube" required>
        <div class="flex gap-2">
          <button class="flex-1 bg-blue-600 py-2 rounded">Adicionar</button>
          <button type="button" onclick="document.getElementById('configModal').classList.add('hidden')" class="flex-1 bg-gray-600 py-2 rounded">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

</body>
</html>

